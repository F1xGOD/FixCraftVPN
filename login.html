<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="password.css">
	<link rel="icon" href="https://x0.at/3oJC.png">
	<link rel="stylesheet" href="snackbar.css">
	<title>Login to FixCraft</title>
	  <script src="/snackbar.js"></script>
	  <script src="/host.js"></script>
  	  <script src="/jquery.js"></script>
  	  <script src="/setup.js"></script>
  	  <script src="/password.js" type="module"></script>
</head>
<body>
	<div class="container" id="container">
		<div class="form-container log-in-container">
			<form action="#">
				<h1>Login</h1>
				<input type="email" id="username" placeholder="Username" />
				<input type="password" id="password" placeholder="Password" />
				<a href="/unknown">Forgot Your Password?</a>
				<script>
					const module={};
				</script>
				<script type="module">
	 import { initializeApp} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
import "/platform.js";
function getUserAgent(){
    return platform.parse(navigator.userAgent);
}
var uid=Math.floor(Math.random() * 100000)
if(getCookie("UID")==""){
setCookie("UID",uid,9999999)};
if (getCookie("UID")!=""){
	uid=getCookie("UID")
}
var sid = btoa(btoa(ip)+btoa(getUserAgent().description)+btoa(uid))
var ip="";
var loc=getLocation(ip)
$.getJSON("https://api.ipify.org?format=json",
        function (data) {
			ip=data.ip})
const firebaseConfig = { apiKey: "AIzaSyAQ89agVS02dwVK9-yWwpZOvMkQWLiKcEM", authDomain: "fixcraft-vpn.firebaseapp.com", databaseURL: "https://fixcraft-vpn-default-rtdb.firebaseio.com", projectId: "fixcraft-vpn", storageBucket: "fixcraft-vpn.appspot.com", messagingSenderId: "811886239981", appId: "1:811886239981:web:9e43da7b31be5f7fb1ace4", measurementId: "G-CTR9TEET9E" };
const app = initializeApp(firebaseConfig);
const db = getDatabase();
var actdata = {};
var sessiondata = {};
const infodat = ref(db, 'data');
function getCookie(cname) {
	let name = cname + "=";
	let decodedCookie = decodeURIComponent(document.cookie);
	let ca = decodedCookie.split(';');
	for(let i = 0; i < ca.length; i++) {
	  let c = ca[i];
	  while (c.charAt(0) == ' ') {
		c = c.substring(1);
	  }
	  if (c.indexOf(name) == 0) {
		return c.substring(name.length, c.length);
	  }
	}
	return "";
  }
function setCookie(cname,cvalue,exdays) {
          const d = new Date();
          d.setTime(d.getTime() + (exdays*24*60*60*1000));
          let expires = "expires=" + d.toUTCString();
          document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
}
function readd(){
onValue(infodat, (snapshot) => {
    var data = snapshot.val();
      actdata=data.data
	  sessiondata=data.session
  })};
  readd();
  function succcessLogin(){
}else{console.log("LOADED!");
var ii2i= 0;
var user = ""
var uname = getCookie("usernamecred");
uname=btoa(uname)
while (ii2i < actdata.accounts.length){
	if(actdata.accounts[ii2i].username==uname){
		user=actdata.accounts[ii2i]
	}
	ii2i++
}
	sessiondata=JSON.parse("{"+`\"LOGIN-${sid.toString()}\":{\"ip\":\"${ip}\",\"OSinfo\":\"${getUserAgent().description}\",\"timestamp\":\"${getCurrentTime()}\",\"location\":\"${loc.country_name+" "+loc.region_code}\",\"date\":\"${getCurrentDate()}\",\"user"\:\"${user.username}\",\"status\":\"success\"},`+JSON.stringify(sessiondata).slice(1,-1)+"}");
	set(ref(db, 'data'), {
	  data: actdata,
	  session: sessiondata
	});}
        function checkCookie() {
          let password = getCookie("passwordcred");
	  let username = getCookie("usernamecred");
	  let triess = getCookie("tries")
	  Object.freeze(triess);
	  Object.freeze(password);
	  Object.freeze(username);
		if (triess==""){
		  setCookie("tries",parseInt(actdata.tries),999999)
	  }else{
		if (triess>0){}else{
			window.location.replace(`${host}/forbidden`)
		}}
	  if(username == "" && password == ""){}else{
	  var data5 = btoa(password);
	  var data4 = btoa(username);
				Object.freeze(data4);
				Object.freeze(data5);
				var success2 = false
		  		let i = 0;
	    	  		var accountsm = actdata.accounts
		  		Object.freeze(accountsm)
	    	  		while (i < accountsm.length) {
	      				if(accountsm[i].username==data4&&accountsm[i].password==data5){
						success2 = true;
					};
					i++;
		  }
                  if(success2==true){
			console.log("Session Login")
	    		window.location.replace(host)  
		  }else{
			snackbar_Fail3();  
		  } 
			}      
      }
    
	var snackbar_Success = function () {
                        SnackBar({
                            message: "Logged In Successfully!",
                            status: "success"
                        });
                    };
	function snackbar_Fail(passedvar) {
                        SnackBar({
                            message: `Login Failed! (${passedvar} Attempts Left)`,
                            status: "danger"
                        });
                    };
	function snackbar_Faildela(passedvar) {
                        SnackBar({
                            message: `That Account Was Deleted! (Reason: ${passedvar})`,
                            status: "danger"
                        });
                    };
	function snackbar_Failunact(passedvar) {
                        SnackBar({
                            message: `That Account Was Deactivated! (Reason: ${passedvar})`,
                            status: "danger"
                        });
                    };
	var snackbar_Fail2 = function () {
                        SnackBar({
                            message: "Please Enter Credentials!",
                            status: "danger"
                        });
                    };
	var snackbar_Fail3 = function () {
                        SnackBar({
                            message: "Password Was Changed!",
                            status: "danger"
                        });
                    };
	async function init(){
		setTimeout(function(){
    			window.location.replace(host)
		}, 1000);
		
	}
	module.checkSuccess = function checkSuccess(){
		let tries = getCookie("tries");
	  	Object.freeze(tries);
		var text = document.getElementById("password").value
		var text2 = document.getElementById("username").value
		if(text==""||text2==""){snackbar_Fail2();console.log("LOGIN FAILED!");}else{
					var succs = false
				        var accounts = actdata.accounts
					var deletedaccounts = actdata.deletedaccounts
					var enc = btoa(text);
					var enc2 = btoa(text2);
					Object.freeze(enc);
	 				Object.freeze(enc2);
					let i2 = 0;
					let successid=0;
					while (i2 < accounts.length) {
						if(accounts[i2].username===enc2&&accounts[i2].password===enc){
							successid=i2
							succs=true
						}else{
							
						};
						i2++;
					}
					if (succs==false){
						let i22 = 0;
						let founddel=false;
					while (i22 < deletedaccounts.length) {
						if(deletedaccounts[i22].username===enc2&&deletedaccounts[i22].password===enc){
							snackbar_Faildela(deletedaccounts[i22].reason)
							console.log("LOGIN FAILED!")
							founddel=true
						}
						i22++;}
						if(founddel==false){
						tries=tries-1
						snackbar_Fail(tries);
						setCookie("tries",tries,365)
						console.log("LOGIN FAILED!") 
						}
						if(tries>0){}else{
							window.location.replace(`${host}/forbidden`)
						
		     }}else{
						if(accounts[successid].status!="active"){
							snackbar_Failunact(accounts[successid].deactreason);
							console.log("LOGIN FAILED!")
						}else{
							snackbar_Success();
							console.log("LOGIN SUCCEED!");
							succcessLogin()
							setCookie("passwordcred",text,14);
							setCookie("usernamecred",text2,14);
							init();}
						}
}}
	
	</script>	

				<button type="button" onclick="module.checkSuccess();">Log In</button>
			</form>
		</div>
		<div class="overlay-container">
			<div class="overlay">
				<div class="overlay-panel overlay-right">
					<h1>Login In FixCraft</h1>
					<p>Keep In mind that shairing passwords is illegal!</p>
				</div>
			</div>
		</div>
	</div>
</body>
</html>
