<!DOCTYPE html>
<html>
<head>
<title>ADMIN SETTINGS</title>
  <script src="/host.js"></script>
  <script src="/jquery.js"></script>
  <script src="/password.js" type="module"></script>
  <link rel="stylesheet" href="snackbar.css">
  <script src="/snackbar.js"></script>
<link rel="icon" href="https://x0.at/CVDX.png">
<link rel="stylesheet" data-purpose="Layout StyleSheet" title="Web Awesome" href="/css/app-wa-462d1fe84b879d730fe2180b0e0354e0.css?vsn=d">
<link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.5.1/css/all.css">
<link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.5.1/css/sharp-thin.css">
<link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.5.1/css/sharp-solid.css">
<link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.5.1/css/sharp-regular.css">
<link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.5.1/css/sharp-light.css">
<style type="text/css">
    p.text { color:#4C4C4C;font-weight:bold;font-family:Calibri;font-size:20 }
    span.deactivated { color:#FF0000;font-weight:bold;font-family:Calibri;font-size:20 }
    span.active { color:#36cc00;font-weight:bold;font-family:Calibri;font-size:20 }
    span.suspended { color:#fc9a08;font-weight:bold;font-family:Calibri;font-size:20 }
	button.btn { background-color: DodgerBlue; border: none; color: white; cursor: pointer; padding: 3px 5px; font-size: 13px; border-radius: 4px; }
	button.save{ background-color: DodgerBlue; border: none; color: white; cursor: pointer; padding: 5px; border-radius: 4px; font-weight:bold;font-family:Calibri;font-size:20 }
</style>
</head>
<body>
<p class="text" id="log">LOADING...</p>
<script>
const module = {};
</script>
<script type="module">
import { initializeApp} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
const firebaseConfig = { apiKey: "AIzaSyAQ89agVS02dwVK9-yWwpZOvMkQWLiKcEM", authDomain: "fixcraft-vpn.firebaseapp.com", databaseURL: "https://fixcraft-vpn-default-rtdb.firebaseio.com", projectId: "fixcraft-vpn", storageBucket: "fixcraft-vpn.appspot.com", messagingSenderId: "811886239981", appId: "1:811886239981:web:9e43da7b31be5f7fb1ace4", measurementId: "G-CTR9TEET9E" };
const app = initializeApp(firebaseConfig);
const db = getDatabase();
var actdata = {};
function snackbar_Loading(passedvar) {
                        SnackBar({
                            message: `Loading... (${passedvar})`,
							timeout:650,
							dismissible:false,
                            status: "warning"
                        });
                    };
function snackbar_Successs() {
                        SnackBar({
                            message: `Saved Successfully!`,
							timeout:1560,
							dismissible:false,
                            status: "success"
                        });
                    };
const infodat = ref(db, 'data');
onValue(infodat, (snapshot) => {
    const data = snapshot.val();
      actdata=data.data
  })
  console.log(actdata)
function getCookie(cname) {
	let name = cname + "=";
	let decodedCookie = decodeURIComponent(document.cookie);
	let ca = decodedCookie.split(';');
	for(let i = 0; i < ca.length; i++) {
	  let c = ca[i];
	  while (c.charAt(0) == ' ') {
		c = c.substring(1);
	  }
	  if (c.indexOf(name) == 0) {
		return c.substring(name.length, c.length);
	  }
	}
	return "";
  }
function setCookie(cname,cvalue,exdays) {
          const d = new Date();
          d.setTime(d.getTime() + (exdays*24*60*60*1000));
          let expires = "expires=" + d.toUTCString();
          document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
}
module.writeus = function writeUserData() {
  const db = getDatabase();
  set(ref(db, 'data'), {
    data: actdata
  });
  snackbar_Successs();
}

function ReplaceContent(NC) {
	document.open();
	document.write(NC);
	document.close();
	  }
function checkREADY22(fistt){
if(JSON.stringify(actdata)=="{}"){
  setTimeout(function(){
  checkREADY22(true)}, 100)
}else{console.log("LOADED!");
module.delac = function delac(actid) { 
snackbar_Loading(`Deleting - ${atob(actdata.accounts[actid].username)}`);
actdata.deletedaccounts=actdata.deletedaccounts.concat(actdata.accounts[actid]);
var test = []
for (let i24 = 0; i24 < actdata.accounts.length; i24++) {
    if (actdata.accounts[i24] !== actdata.accounts[actid]) {
        test.push(actdata.accounts[i24]);
    }
}

actdata.accounts=test;
test=[];
var reas="test1f"
var positem =actdata.deletedaccounts[actdata.deletedaccounts.length-1];
actdata.deletedaccounts[actdata.deletedaccounts.length-1]=JSON.parse(JSON.stringify(positem).replace("}","")+`,\"reason\":\"${reas}\"}`)
checkREADY22(false);
};

module.rest = function rest(actid) {
snackbar_Loading(`Restoring - ${atob(actdata.deletedaccounts[actid].username)}`);
delete actdata.deletedaccounts[actid].reason;
actdata.accounts=actdata.accounts.concat(actdata.deletedaccounts[actid]);
var test2 = [];
for (let i241 = 0; i241 < actdata.deletedaccounts.length; i241++) {
    if (actdata.deletedaccounts[i241] !== actdata.deletedaccounts[actid]) {
        test2=test2.concat(actdata.deletedaccounts[i241]);
    };
}
actdata.deletedaccounts=test2;
test2=[];
checkREADY22(false);
};

module.activ = function activ(actid) { 
snackbar_Loading(`Activating - ${atob(actdata.accounts[actid].username)}`);
actdata.accounts[actid].status="active"
delete actdata.accounts[actid].deactreason
checkREADY22(false);
};

module.deactiv = function deactiv(actid) { 
snackbar_Loading(`Deactivating - ${atob(actdata.accounts[actid].username)}`);
actdata.accounts[actid].status="deactivated"
actdata.accounts[actid].deactreason="ttst"
checkREADY22(false);
};

module.susp = function susp(actid) {
snackbar_Loading(`Suspending - ${atob(actdata.accounts[actid].username)}`);
actdata.accounts[actid].status="suspended"
actdata.accounts[actid].deactreason="tys"
checkREADY22(false);
};
if(fistt==true){
document.getElementById('log').innerHTML = `INITIALIZING...`}
var uname = getCookie("usernamecred");
var ii2i= 0;
var role = ""
uname=btoa(uname)
while (ii2i < actdata.accounts.length){
	if(actdata.accounts[ii2i].username==uname){
		role=actdata.accounts[ii2i].role
	}
	ii2i++
}
var accesslevel = 0
if(role=="debugger"){ accesslevel=2}else{if(role=="moderator"){ accesslevel=3}if(role=="admin"){ accesslevel=4}}
if(role=="admin" || role=="moderator" || role=="debugger"){
	var accountsm = actdata.accounts
	Object.freeze(accountsm)
	var final = ``
	final = `STATUS: ${actdata.status.toUpperCase()}<br>`
	final += `LOGIN ATTEMPTS: ${actdata.tries}<br><br>`
	final += `ACCOUNTS: <br>`
	var accountsm = actdata.accounts
	var accountsdel = actdata.deletedaccounts
	Object.freeze(accountsm)
	var psw = "";
for (var i = 0; i < accountsm.length; i++) {
    (function(i) { // protects i in an immediately called function
		var data2 = atob(accountsm[i].password);
		var data = atob(accountsm[i].username);
	      						var level = 0
	      						if(accountsm[i].role=="debugger"){ level=2}else{if(accountsm[i].role=="moderator"){ level=3}if(accountsm[i].role=="admin"){ level=4}}
	      						if(accesslevel<level){psw = "********"}else{psw = data2}
	                                                           if(accountsm[i].status == "active"){
	                                final += `&nbsp;&nbsp;&nbsp;&nbsp;USERNAME: ${data}, PASSWORD: ${psw}, ROLE: ${accountsm[i].role.charAt(0).toUpperCase()+accountsm[i].role.slice(1)}, JOB: ${accountsm[i].job.charAt(0).toUpperCase()+accountsm[i].job.slice(1)}, STATUS: <span class=\"${accountsm[i].status}\">${accountsm[i].status.charAt(0).toUpperCase()+accountsm[i].status.slice(1)}&nbsp;&nbsp;&nbsp;</span><button id=\"${i}\" class=\"btn\" onclick=\"module.delac(this.id)\"><i class=\"fa fa-trash\"></i></button><span>&nbsp;&nbsp;</span><button id=\"${i}\" class=\"btn\" onclick=\"module.susp(this.id)\"><i class="fa-solid fa-timer"></i></button><span>&nbsp;&nbsp;</span><button id=\"${i}\" class=\"btn\" onclick=\"module.deactiv(this.id)\"><i class="fa-solid fa-octagon-exclamation"></i></button><br>`}else{
									final += `&nbsp;&nbsp;&nbsp;&nbsp;USERNAME: ${data}, PASSWORD: ${psw}, ROLE: ${accountsm[i].role.charAt(0).toUpperCase()+accountsm[i].role.slice(1)}, JOB: ${accountsm[i].job.charAt(0).toUpperCase()+accountsm[i].job.slice(1)}, REASON: ${accountsm[i].deactreason}, STATUS: <span class=\"${accountsm[i].status}\">${accountsm[i].status.charAt(0).toUpperCase()+accountsm[i].status.slice(1)}&nbsp;&nbsp;&nbsp;</span><button id=\"${i}\" class=\"btn\" onclick=\"module.activ(this.id)\"><i class=\"fa fa-toggle-on\"></i></button><span>&nbsp;&nbsp;</span><button id=\"${i}\" class=\"btn\" onclick=\"module.delac(this.id)\"><i class=\"fa fa-trash\"></i></button><br>`
								}              
if(i==accountsm.length-1){
					setTimeout(function(){
						final+=`TOTAL ${accountsm.length} ACCOUNTS<br><br>`
					final+=`DELETED ACCOUNTS:<br>`
					for (var ii22 = 0; ii22 < accountsdel.length; ii22++) {
    (function(ii22) { // protects i in an immediately called function
		var data4 = atob(accountsdel[ii22].password);
		var data3 = atob(accountsdel[ii22].username);
    	      						var level2 = 0
	      						if(accountsdel[ii22].role=="debugger"){ level2=2}else{if(accountsdel[ii22].role=="moderator"){ level2=3}if(accountsdel[ii22].role=="admin"){ level2=4}}
	      						if(accesslevel<level2){psw = "********"}else{psw = data4}
	                                               
        						final += `&nbsp;&nbsp;&nbsp;&nbsp;USERNAME: ${data3}, PASSWORD: ${psw}, ROLE: ${accountsdel[ii22].role.charAt(0).toUpperCase()+accountsdel[ii22].role.slice(1)}, JOB: ${accountsdel[ii22].job.charAt(0).toUpperCase()+accountsdel[ii22].job.slice(1)}, REASON: ${accountsdel[ii22].reason}, STATUS: <span class=\"${accountsdel[ii22].status}\">${accountsdel[ii22].status.charAt(0).toUpperCase()+accountsdel[ii22].status.slice(1)}</span>/<span class=\"deactivated\">Deleted&nbsp;&nbsp;&nbsp;</span><button id=\"${ii22}\" class=\"btn\" onclick=\"module.rest(this.id)\"><i class=\"fa fa-undo\"></i></button><br>`
								if(ii22==accountsdel.length-1){
						setTimeout(function(){
			    	final+=`TOTAL ${accountsdel.length} DELETED ACCOUNTS<br><br>`
					final+=`PAGES UNDER MAINTENANCE:<br>`
					for (var ii2 = 0; ii2 < actdata.undermaintenance.length; ii2++) {
    				(function(ii2) { 
					final+=`&nbsp;&nbsp;&nbsp;&nbsp;PAGE: ${actdata.undermaintenance[ii2].location}, REASON: ${actdata.undermaintenance[ii2].reason}<br>`
                    if(ii2==actdata.undermaintenance.length-1){
						setTimeout(function(){
							final+=`TOTAL ${actdata.undermaintenance.length} PAGES UNDER MAINTENANCE <br><br>`
							final+=`<button onclick="module.writeus()" class="save"><i class="fa fa-save"></i>&nbsp; Save&nbsp;</button>`
							document.getElementById('log').innerHTML = final
						},40)
        			}
      })(ii2)};
	}, 40)
      }
    })(ii22);
}
					}, 40)
      }

    })(i);
}
}else{
  window.location.replace(`${host}/forbidden`);
}}}
checkREADY22(true);
</script>
</body>
</html>
